<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>RPlayer BOOT</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <style type="text/css">
        iframe {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1000;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>
    <iframe src="./rplayer.htm" frameborder="0"></iframe>
    <script type="text/ecmascript">
        class Boot {
            constructor() {
                this.appIframe = document.getElementsByTagName("iframe")[0].contentWindow;
                console.log(this.appIframe);

                this.reload();
                // this.tryAgain();
            }

            checkState() {
                var that = this;
                this.appIframe.onload = function() {
                    var reloading = sessionStorage.getItem("reloading");
                    if (reloading) {
                        sessionStorage.removeItem("reloading");
                        that.myFunction();
                    }
                }
            }

            reload() {
                sessionStorage.setItem("reloading", "true");
                this.appIframe.location.reload();
                this.checkState();
            }

            myFunction() {
                alert("hotovo");
                this.reload();
            }

            // tryAgain() {
            //     var that = this;
            //     this.appIframe.onload = function() {
            //         console.log(that.appIframe);
            //         // alert("ahoj");
            //         that.appIframe.location.reload();
            //         setTimeout(function() {
            //             that.tryAgain();
            //         },2000);
            //     }
            // }

            // constructor() {
            //     const appIframe = document.getElementsByTagName("iframe")[0].contentWindow;
            //     setInterval(function() {
            //         console.log(appIframe.console.history);
            //     },2000);
            //     appIframe.onErrorUpdate = function() {
            //         console.log("ahoj");
            //     };
                
            //     this.console.history = [];
            // }

            // getConsole() {
            //     console.history = [];
            //     var oldConsole = {};
            //     for (var i in console) {
            //         if (typeof console[i] == 'function') {
            //             oldConsole[i] = console[i];
            //             var strr = '(function(){\
            //                 this.console.history.push({func:\'' + i + '\',args : Array.prototype.slice.call(arguments)});\
            //                 oldConsole[\'' + i + '\'].apply(console, arguments);\
            //             })';
            //             console[i] = eval(strr);
            //         }
            //     }
            // }
        }
        BootClass = new Boot();
    </script>
</body>
</html>