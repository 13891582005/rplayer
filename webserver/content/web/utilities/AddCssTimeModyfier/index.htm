<!DOCTYPE html>
<html manifest="media.appcache">
    <head>
        <script>
            
            window.addEventListener('error', function(e) {
                window.top.postMessage("[BOOT-RELOAD]", '*');
            }, true);
            
        </script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <title>RPlayer (min v1.42.61) :: Utility - AddCssTimeModyfier v0.0.1 (2022)</title>

        <link rel="icon" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8IS0tIENyZWF0b3I6IENvcmVsRFJBVyAyMDE4ICg2NCBiaXTFrykgLS0+DQo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjIxMG1tIiBoZWlnaHQ9IjIxMG1tIiB2ZXJzaW9uPSIxLjEiIHN0eWxlPSJzaGFwZS1yZW5kZXJpbmc6Z2VvbWV0cmljUHJlY2lzaW9uOyB0ZXh0LXJlbmRlcmluZzpnZW9tZXRyaWNQcmVjaXNpb247IGltYWdlLXJlbmRlcmluZzpvcHRpbWl6ZVF1YWxpdHk7IGZpbGwtcnVsZTpldmVub2RkOyBjbGlwLXJ1bGU6ZXZlbm9kZCINCnZpZXdCb3g9IjAgMCAyMTAwMCAyMTAwMCINCiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+DQogPGRlZnM+DQogIDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQogICA8IVtDREFUQVsNCiAgICAuc3RyMSB7c3Ryb2tlOiMyQjJBMjk7c3Ryb2tlLXdpZHRoOjIwO3N0cm9rZS1taXRlcmxpbWl0OjIyLjkyNTZ9DQogICAgLnN0cjAge3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6MjA7c3Ryb2tlLW1pdGVybGltaXQ6MjIuOTI1Nn0NCiAgICAuZmlsMSB7ZmlsbDpibGFja30NCiAgICAuZmlsMiB7ZmlsbDojNDE4M0M0fQ0KICAgIC5maWwwIHtmaWxsOndoaXRlfQ0KICAgXV0+DQogIDwvc3R5bGU+DQogPC9kZWZzPg0KIDxnIGlkPSJWcnN0dmFfeDAwMjBfMSI+DQogIDxtZXRhZGF0YSBpZD0iQ29yZWxDb3JwSURfMENvcmVsLUxheWVyIi8+DQogIDxnIGlkPSJMb2dvX3gwMDIwX1JQbGF5ZXIiPg0KICAgPHJlY3QgY2xhc3M9ImZpbDAiIHdpZHRoPSIyMTAwMCIgaGVpZ2h0PSIyMTAwMCIgcng9IjI5NzMuOTYiIHJ5PSIyOTczLjk2Ii8+DQogICA8ZyBpZD0iTG9nb194MDAyMF9SUGxheWVyX3gwMDIwXzEiPg0KICAgIDxwYXRoIGNsYXNzPSJmaWwxIiBkPSJNNjQ1MC40OCAxMjEwMy43bDY3MC44MyAtMzg3LjMgNzg4MS4yOCAtNDU1MC4yNmMxNDkuNDYsLTg2LjI5IDIzNSwtMjM0LjQ1IDIzNSwtNDA3LjAzIDAsLTE3Mi41OCAtODUuNTQsLTMyMC43NCAtMjM1LC00MDcuMDNsLTg1NTIuMTEgLTQ5MzcuNTZjLTE0OS40NiwtODYuMjkgLTMyMC41NCwtODYuMjkgLTQ3MCwwIC0xNDkuNDUsODYuMjkgLTIzNSwyMzQuNDUgLTIzNSw0MDcuMDNsMCA5ODc1LjExYzAsMTcyLjU4IDg1LjU0LDMyMC43NSAyMzUsNDA3LjA0IDE0OS40Niw4Ni4yOCAzMjAuNTQsODYuMjkgNDcwLDB6bTY3MC44MyAtMjU3Ny4xOWwwIC01NTM0LjggMCAtODE0LjA2IDcwNC44MSA0MDYuOTIgMjM5Ni44MyAxMzgzLjgxIDMxMDEuNjMgMTc5MC43MyAtMzEwMS42MyAxNzkwLjczIC0yMzk2LjgzIDEzODMuODEgLTcwNC44MSA0MDYuOTIgMCAtODE0LjA2eiIvPg0KICAgIDxwYXRoIGNsYXNzPSJmaWwxIiBkPSJNNjIxNS40OCAxMjc4NS43N2w0MzUuODMgMGMyNTguODcsMCA0NzAsMjExLjEzIDQ3MCw0NzBsMCA2MDE0LjIxYzAsMjU4Ljg3IC0yMTEuMTMsNDcwIC00NzAsNDcwbC00MzUuODMgMGMtMjU4Ljg3LDAgLTQ3MCwtMjExLjEzIC00NzAsLTQ3MGwwIC02MDE0LjIxYzAsLTI1OC44NyAyMTEuMTMsLTQ3MCA0NzAsLTQ3MHoiLz4NCiAgICA8cGF0aCBjbGFzcz0iZmlsMSBzdHIwIiBkPSJNOTg3Mi45NyAxOTI2OS45OGwwIC02MDE0LjIxYzAsLTI1OC44NyAyMTEuMTMsLTQ3MCA0NzAsLTQ3MGw0MzUuODMgMGMyNTguODcsMCA0NzAsMjExLjEzIDQ3MCw0NzBsMCA2MDE0LjIxYzAsMjU4Ljg3IC0yMTEuMTMsNDcwIC00NzAsNDcwbC00MzUuODMgMGMtMjU4Ljg3LDAgLTQ3MCwtMjExLjEzIC00NzAsLTQ3MHoiLz4NCiAgICA8cG9seWdvbiBjbGFzcz0iZmlsMiBzdHIxIiBwb2ludHM9IjcxMjEuMzEsMzk5MS43MSA3MTIxLjMxLDk1MjYuNTEgNzEyMS4zMSwxMDM0MC41NyA3ODI2LjEyLDk5MzMuNjUgMTAyMjIuOTUsODU0OS44NCAxMzMyNC41OCw2NzU5LjExIDEwMjIyLjk1LDQ5NjguMzggNzgyNi4xMiwzNTg0LjU3IDcxMjEuMzEsMzE3Ny42NSAiLz4NCiAgIDwvZz4NCiAgPC9nPg0KIDwvZz4NCjwvc3ZnPg0K">
        
        <link rel="stylesheet" href="../../vendor/semantic/ui/dist/semantic.css">
        
        <script src="../../src/js/foreign/jquery.js"></script>
        <script src="../../src/js/foreign/jquery.transit.min.js"></script>
        <script src="../../src/js/foreign/current-device.js"></script>
        <script src="../../vendor/stuk/jszip/dist/jszip.min.js"></script>
        <script src="../../vendor/stuk/jszip/vendor/FileSaver.js"></script>
        <script src="../../vendor/semantic/ui/dist/semantic.min.js"></script>
        <script src="../../vendor/robinherbots/jquery.inputmask/dist/jquery.inputmask.min.js"></script>
        <script src="../../src/js/foreign/jquery.fullscreen.min.js"></script>
        <style>
            :root {
                --errorBgColor: rgba(255,230,230,1);
                --textColor: rgba(255,255,255,1);
                --bodyBgColor: rgba(255,255,255,1);
            }
            
            /* body * {
                color: white !important;
            } */
            
            body {
                position: fixed;
                display: flex;
                justify-content: center;
                align-items: center;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                color: var(--textColor) !important;
            }

            .leftSide,
            .rightSide,
            .middleSide {
                display: flex !important;
                justify-content: center;
                align-items: center;
            }

            .layout {
                position: fixed;
                width: 100% !important;
                height: 100% !important;
            }

            .leftSide textarea,
            .rightSide textarea {
                width: 100% !important;
                min-width: none !important;
                height: 100% !important;
                max-height: none !important;
                resize: none !important;
                /* font-family: 'Courier New', Courier, monospace; */
            }

            .middleSide .errors {
                margin: .25em 0 .25em 0 !important;
                resize: vertical;
                max-height: 100% !important;
            }

            input[type='text'],
            .middleSide .errors,
            .middleSide .processBtn {
                margin: .25em 0 .25em 0 !important;
            }

            .middleSide .processBtn {
                width: 100%;
            }
        </style>
    </head>
    <body>
        <form class="ui form three columns stackable grid layout" id="mainForm">
            <div class="six wide column leftSide">
                <textarea placeholder="rplayer.conf.js >> object cssTimeModyfier" class="form-control confSource" wrap="soft" name="source"></textarea>
            </div>
            <div class="four wide column middleSide">
                <div>
                    <div class="positive ui button processBtn disabled">Process JSON</div>
                    <input type="text" name="cssFx" class="form-control cssFx" placeholder="CSS key">
                    <input type="text" name="cssSelector" class="form-control cssSelector" placeholder="CSS selector">
                    <input type="text" name="offset" class="form-control offset" placeholder="Data offset [ms]">
                    <textarea class="form-control errors" readonly wrap="soft"></textarea>
                </div>
            </div>
            <div class="six wide column rightSide">
                <textarea placeholder='[{"TimeMs": <int>,"LengthMs": <int>}, ...]' class="form-control addCode" wrap="soft" name="add"></textarea>
            </div>
        </form>
    </body>
    <script type="text/ecmascript">
        /**
         * @file AddCssTimeModyfier utility for RPlayer web application
         * @copyright Robert Rajs 2022
         * @author Robert Rajs
         * @see {@link https://rajs.info|Home}
         * @see {@link https://zesilovac.cz|Zesilovaƒç}
         * @see {@link https://bandzone.cz/rajs|Bandzone}
         * @see {@link https://technotramp.com|Technotramp}
         * @see {@link https://github.com/entlaabstudio/rplayer|GitHub}
         * @see {@link https://cs-cz.facebook.com/robert.rajs.9|Facebook}
         * @license
         * Copyright (c) 2022 Robert Rajs
         * 
         * Permission is hereby granted, free of charge, to any person obtaining a copy
         * of this software and associated documentation files (the "Software"), to deal
         * in the Software without restriction, including without limitation the rights
         * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
         * copies of the Software, and to permit persons to whom the Software is
         * furnished to do so, subject to the following conditions:
         * 
         * The above copyright notice and this permission notice shall be included in all
         * copies or substantial portions of the Software.
         * 
         * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
         * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
         * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
         * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
         * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
         * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
         * SOFTWARE.
         */
        class AddCssTimeModyfier {
            constructor() {
                var that = this;
                $(document).ready(
                    function() {
                        that.init();
                    }
                );
            }

            init() {
                this.css = {
                    entrance: {
                        backgroundColor: "pink"
                    },
                    outgoing: {
                        backgroundColor: "white"
                    },
                    possibleSelectors: [
                        ".confSource",
                        ".addCode",
                        ".cssFx",
                        ".cssSelector",
                        ".offset"
                    ]
                }
                this.checkForm();
            }

            checkForm() {
                var that = this;
                $("#mainForm").on("keyup change paste",function() {
                    that.errors = {};
                    that.checkConfSource();
                    that.checkFxInput();
                    that.checkCssSelectorInput();
                    that.checkAddCode();
                    that.printErrors();
                    that.okState();
                    that.inputMask();
                    that.processAction();
                });
            }

            processAction() {
                var that = this;
                if (this.processActionInit === undefined) {
                    that.processActionInit = true;
                    
                    function getRealTimeMs(time) {
                        var existsTime = 0;
                        var time;
                        for (const [key,value] of Object.entries(that.obj.cssTimeModyfier.commandsInTime)) {
                            if (parseInt(key) <= time) {
                                existsTime = parseInt(key);
                            }
                        }
                        if (existsTime == time) {
                            time += 1;
                            getRealTimeMs(time);
                        } else {
                            console.log(existsTime,time)
                            return time;
                        }
                    }

                    $(document).on("click",".processBtn",function() {
                        if (Object.keys(that.errors).length == 0) {
                            console.log(that.jsonObj);
                            if ($(".offset").val() == "") {
                                $(".offset").val("0");
                            }
                            var offset = parseInt($(".offset").val());
                            var cssSelector = $(".cssSelector").val();
                            var cssFx = $(".cssFx").val();
                            var jsonTimeMs;
                            for (const [key,value] of Object.entries(that.jsonObj)) {
                                jsonTimeMs = value.TimeMs + offset;
                                console.log(offset, cssSelector, cssFx, value.TimeMs, jsonTimeMs, getRealTimeMs(jsonTimeMs));
                            }
                        }
                        return false;
                    });
                }
            }

            inputMask() {
                $(".offset").inputmask({"mask" : "99999999"}); //specifying options
                $(".offset").inputmask({"placeholder" : ""});  //static mask
            }

            okState() {
                var that = this;
                if (this.okInfoTicker === undefined) {
                    this.okInfoTicker = true;
                    setInterval(function() {
                        if (Object.keys(that.errors).length == 0) {
                            $(".errors").val("Great! Everything looks good.");
                            if ($(".processBtn").hasClass("disabled")) {
                                $(".processBtn").removeClass("disabled");
                            }
                        } else {
                            if (!$(".processBtn").hasClass("disabled")) {
                                $(".processBtn").addClass("disabled");
                            }
                        }
                    },100);
                }
            }

            checkCssSelectorInput() {
                if ($(".cssSelector").val() == "") {
                    this.pushError("cssSelectorInput", "CSS key must be set.", ".cssSelector");
                } else {
                    try {
                        var selectorEntries = 0;
                        for (const [key, value] of Object.entries(this.obj.cssTimeModyfier.selectors)) {
                            if (key == $(".cssSelector").val()) {
                                selectorEntries += 1;
                            }
                        }
                        if (selectorEntries < 1) {
                            this.pushError("cssSelectorInput", "No CSS selectors entry node in cssTimeModyfier object.", ".cssSelector");
                        }   
                    } catch (error) {
                        
                    }
                }
            }

            checkAddCode() {
                if ($(".addCode").val() == "") {
                    this.pushError("addCode", "JSON for additing must be set.", ".addCode");
                } else {
                    try {
                        this.jsonObj = JSON.parse($(".addCode").val());
                    } catch (error) {
                        this.pushError("addCode", "Syntax error.", ".addCode");
                    }
                }
            }

            checkFxInput() {
                if ($(".cssFx").val() == "") {
                    this.pushError("cssFxInput", "CSS key must be set.", ".cssFx");
                } else {
                    try {
                        var fxEntries = 0;
                        for (const [key, value] of Object.entries(this.obj.cssTimeModyfier.css)) {
                            if (key == $(".cssFx").val()) {
                                fxEntries += 1;
                            }
                        }
                        if (fxEntries < 1) {
                            this.pushError("cssFxInput", "No fx entry node in cssTimeModyfier object.", ".cssFx");
                        }   
                    } catch (error) {
                        
                    }
                }
            }

            checkConfSource() {
                var obj;
                try {
                    
                    eval("obj = {" + $(".leftSide .confSource").val() + "}");
                    this.obj = obj;
                    
                    if (Object.keys(this.obj).length < 1) {
                        this.pushError("confSource", "Nothing here.", ".confSource");
                    }

                    if (this.obj.cssTimeModyfier === undefined) {
                        this.pushError("confSource", "Node cssTimeModyfier not found.", ".confSource");
                    } else {
                        
                        if (this.obj.cssTimeModyfier.selectors === undefined) {
                            this.pushError("confSource", "Node cssTimeModyfier.selectors not found.", ".confSource");
                        }

                        if (this.obj.cssTimeModyfier.css === undefined) {
                            this.pushError("confSource", "Node cssTimeModyfier.css not found.", ".confSource");
                        }

                        if (this.obj.cssTimeModyfier.default === undefined) {
                            this.pushError("confSource", "Node cssTimeModyfier.default not found.", ".confSource");
                        }

                        if (this.obj.cssTimeModyfier.commandsInTime === undefined) {
                            this.pushError("confSource", "Node cssTimeModyfier.commandsInTime not found.", ".confSource");
                        }
                        
                    }


                } catch (error) {
                    this.pushError("confSource", "Syntax error.", ".confSource");
                }
            }

            pushError(where, message, cssSelector) {
                var where, message, cssSelector;
                if (this.errors[where] === undefined) {
                    this.errors[where] = [];
                }
                this.errors[where][Object.keys(this.errors[where]).length] = {
                    cssSelector: cssSelector,
                    message: message
                };
            }

            printErrors() {
                var that = this;
                if (this.printing === undefined) {
                    that.printing = true;
                    setInterval(function() {
                        var allErrors = "";
                        var lat2 = false;
                        var errSelectors = [];
                        for (const [key, value] of Object.entries(that.errors)) {
                            if (lat2) {
                                allErrors += "\n-----\n";
                            }
                            var lat = false;
                            for (const [key2, value2] of Object.entries(value)) {
                                allErrors += ((lat) ? "\n[" : "[") + key + "]\n>> " + value2.message;
                                $(value2.cssSelector).css(that.css.entrance);
                                if (!errSelectors.includes(value2.cssSelector)) {
                                    errSelectors[Object.keys(errSelectors).length] = value2.cssSelector;
                                }
                                lat = true;
                            }
                            lat2 = true;
                        }
                        for (const [key, value] of Object.entries(that.css.possibleSelectors)) {
                            if (!errSelectors.includes(value)) {
                                $(value).css(that.css.outgoing);
                            }
                        }
                        $(".errors").val(allErrors);
                    },100);
                }
            }
        }

        new AddCssTimeModyfier();
    </script>
</html>
